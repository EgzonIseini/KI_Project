<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Blank Page - Picturio</title>
    <meta name="description"
          content="Picturio is a simple image sharing service which allows you to quicky and easily upload all of your images and share them anywhere and with whoever you like. And all that for free!">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.8.2/css/lightbox.min.css">
    <link rel="stylesheet" href="assets/css/styles.min.css">
</head>

<body id="page-top">
<div id="wrapper">
    <nav class="navbar navbar-dark align-items-start sidebar sidebar-dark accordion bg-gradient-primary p-0">
        <div class="container-fluid d-flex flex-column p-0">
            <a class="navbar-brand d-flex justify-content-center align-items-center sidebar-brand m-0"
               data-bs-hover-animate="tada" href="index.html">
                <div class="sidebar-brand-icon rotate-n-15"><i class="fas fa-images"></i></div>
                <div class="sidebar-brand-text mx-3"><span>Picturio</span></div>
            </a>
            <hr class="sidebar-divider my-0">
            <ul class="nav navbar-nav text-light" id="accordionSidebar">
                <li class="nav-item" role="presentation"><a class="nav-link active" href="#"><i class="fas fa-home"></i><span>Home</span></a>
                </li>
                <li class="nav-item" role="presentation"><a class="nav-link" href="gallery.html"><i
                        class="fas fa-grip-horizontal"></i><span>Gallery</span></a></li>
                <li class="nav-item" role="presentation"><a class="nav-link" href="help.html"><i
                        class="fas fa-question"></i><span>Help</span></a></li>
                <li class="nav-item" role="presentation"><a class="nav-link" href="contact-us.html"><i
                        class="fas fa-envelope"></i><span>Contact Us</span></a></li>
            </ul>
            <div class="text-center d-none d-md-inline">
                <button class="btn rounded-circle border-0" id="sidebarToggle" type="button"></button>
            </div>
        </div>
    </nav>
    <div class="d-flex flex-column" id="content-wrapper">
        <div id="content">
            <nav id="notLoggedInNavigation"
                 class="navbar navbar-light navbar-expand bg-white shadow mb-4 topbar static-top hidden">
                <div class="container-fluid">
                    <button class="btn btn-link d-md-none rounded-circle mr-3" id="sidebarToggleTop" type="button"><i
                            class="fas fa-bars"></i></button>
                    <ul class="nav navbar-nav flex-nowrap ml-auto">
                        <div class="d-none d-sm-block topbar-divider"></div>
                        <li class="nav-item dropdown no-arrow" role="presentation">
                        <li class="nav-item dropdown no-arrow"><a class="dropdown-toggle nav-link"
                                                                  data-toggle="dropdown" aria-expanded="false" href="#"><span
                                class="d-none d-lg-inline mr-2 text-gray-600 small">Log In&nbsp;</span><img
                                class="border rounded-circle img-profile" src="assets/img/blank_profile.png"></a>
                            <div
                                    class="dropdown-menu shadow dropdown-menu-right animated--grow-in" role="menu"><a
                                    class="dropdown-item" role="presentation" href="login.html"><i
                                    class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>&nbsp;Log In</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" role="presentation" href="register.html"><i
                                        class="fas fa-user-plus fa-sm fa-fw mr-2 text-gray-400"></i>&nbsp;Register</a>
                            </div>
                        </li>
                        </li>
                    </ul>
                </div>
            </nav>

            <nav id="loggedInNavigation"
                 class="navbar navbar-light navbar-expand bg-white shadow mb-4 topbar static-top hidden">
                <div class="container-fluid">
                    <ul class="nav navbar-nav flex-nowrap ml-auto">
                        <li class="nav-item dropdown show d-sm-none no-arrow"><a class="dropdown-toggle nav-link"
                                                                                 data-toggle="dropdown"
                                                                                 aria-expanded="true" href="#"><i
                                class="fas fa-search"></i></a>
                            <div class="dropdown-menu show dropdown-menu-right p-3 animated--grow-in" role="menu"
                                 aria-labelledby="searchDropdown">
                                <form class="form-inline mr-auto navbar-search w-100">
                                    <div class="input-group"><input class="bg-light form-control border-0 small"
                                                                    type="text" placeholder="Search for ...">
                                        <div class="input-group-append">
                                            <button class="btn btn-primary py-0" type="button"><i
                                                    class="fas fa-search"></i></button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </li>
                        <li class="nav-item dropdown no-arrow mx-1" role="presentation"><a class="nav-link text-dark"
                                                                                           data-bs-hover-animate="flash"
                                                                                           href="profile.html"><i
                                class="far fa-images fa-fw"></i><span>My Gallery</span></a>
                            <div class="shadow dropdown-list dropdown-menu dropdown-menu-right"
                                 aria-labelledby="alertsDropdown"></div>
                        </li>
                        <div class="d-none d-sm-block topbar-divider"></div>
                        <li class="nav-item dropdown no-arrow" role="presentation">
                        <li class="nav-item dropdown no-arrow"><a class="dropdown-toggle nav-link"
                                                                  data-toggle="dropdown" aria-expanded="false"
                                                                  data-bs-hover-animate="flash" href="#"><span
                                class="d-none d-lg-inline mr-2 text-gray-600 small profile-name">Valerie Luna</span><img
                                class="border rounded-circle img-profile"
                                src="assets/img/photo-1517849845537-4d257902454a.jpeg"></a>
                            <div
                                    class="dropdown-menu shadow dropdown-menu-right animated--grow-in" role="menu"><a
                                    class="dropdown-item" role="presentation" href="profile.html"><i
                                    class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>&nbsp;Profile</a><a
                                    class="dropdown-item" role="presentation" href="settings.html"><i
                                    class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i>&nbsp;Settings</a>
                                <div
                                        class="dropdown-divider"></div>
                                <a class="dropdown-item logout" role="presentation" href="#"><i
                                        class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>&nbsp;Logout</a>
                            </div>
                        </li>
                        </li>
                    </ul>
                </div>
            </nav>
            <div class="container-fluid">
                <div id="notLoggedLandingPage" class="jumbotron hidden">
                    <h1>Welcome to Picturio</h1>
                    <p>Picturio is a simple image sharing service which allows you to quicky and easily upload all of
                        your images and share them anywhere and with whoever you like. And all that for
                        <strong>free!</strong><br><br><strong>All you have to do in order to get started is </strong>
                        <a
                                href="login.html"><strong>Log In</strong></a><strong> or </strong><a
                                href="register.html"><strong>Register</strong></a><strong> if you don't have an account!
                            :)</strong></p>
                    <div class="row">
                        <div class="col"><a class="btn btn-primary btn-lg border-secondary d-block" role="button"
                                            style="background-color: #d347a8;background-image: linear-gradient(90deg,#d347a8 10%,#853b92);"
                                            href="login.html">Log In</a></div>
                        <div class="col"><a class="btn btn-primary btn-lg border-secondary d-block" role="button"
                                            style="background-color: #853b92;background-image: linear-gradient(90deg,#853b9210%,#122a71);"
                                            href="register.html">Register</a></div>
                    </div>
                </div>
                <div id="loggedInLandingPage" class="card mb-3 hidden">
                    <div class="card-header">
                        <h3 class="text-dark mb-1">Upload a Picture</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col">
                                <div class="dashed_upload mt-1 mb-2">
                                    <div class="wrapper">
                                        <div class="drop">
                                            <div class="cont">
                                                <i class="far fa-images"></i>
                                                <div class="tit">Drag & Drop</div>
                                                <div class="desc">or</div>
                                                <div class="btn btn-primary">Browse</div>
                                            </div>
                                            <output id="list"></output>
                                            <form enctype="multipart/form-data" method="POST"><input id="files" multiple
                                                                                                     names="file[]"
                                                                                                     type="file"/>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="photoUploadInterface" class="hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="text-dark mb-1">Picture Details</h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-6 d-xl-flex justify-content-xl-center align-items-xl-center"><img
                                        class="img-fluid" id="previewImage" src=""/></div>
                                <div class="col">
                                    <form>
                                        <div class="form-group"><label for="title">Picture Title</label><input
                                                type="text" class="form-control form-control-sm" name="title" id="title"
                                                minlength="5" required/></div>
                                        <div class="alert alert-danger hidden" id="titleAlert">Title must be more than
                                            <strong>5 characters</strong> long!
                                        </div>
                                        <div class="form-group"><label for="caption">Caption</label><textarea
                                                class="form-control" name="caption" id="caption"></textarea></div>
                                    </form>
                                    <small>If toggled on, your picture will be public and can be discovered by anyone.
                                        If not then only people withe the link can view it.
                                    </small>
                                    <br/>
                                    <small id="privacyText">Current: Private.<br/></small>
                                    <div class="form-group d-xl-flex justify-content-xl-start align-items-xl-center">
                                        <div class="custom-control disabled custom-switch"><input type="checkbox"
                                                                                                  class="custom-control-input"
                                                                                                  id="formCheck-1"/><label
                                                class="custom-control-label" for="formCheck-1">Public</label></div>
                                    </div>
                                    <button class="btn btn-primary btn-block btn-lg" id="uploadButton" type="button">
                                        Upload
                                    </button>
                                    <div role="group" class="btn-group"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="bg-white sticky-footer">
            <div class="container my-auto">
                <div class="text-center my-auto copyright"><span>Copyright © Picturio 2019</span></div>
            </div>
        </footer>
    </div>
    <a class="border rounded d-inline scroll-to-top" href="#page-top"><i class="fas fa-angle-up"></i></a></div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.8.2/js/lightbox.min.js"></script>
<script src="assets/js/script.min.js"></script>
<script>
    $(document).ready(function () {

        let accessToken = localStorage.getItem("access_token");
        let file = null;
        if (accessToken == undefined) toggleGuestNavigation();

        getUserDetails(accessToken);

        $(".logout").on('click', function () {
            logout();
        });

        $("#files").change(function (event) {
            file = event.target.files[0];
            showImage(this);
            $("#photoUploadInterface").show();
        });

        $("#formCheck-1").change(function () {
            if (this.checked) {
                $("#privacyText").text("Current: Public");
            } else {
                $("#privacyText").text("Current: Private");
            }
        })

        $("#uploadButton").on('click', function () {
            let title = $("#title").val(),
                caption = $("#caption").val(),
                privacy = $("#formCheck-1").is(":checked") ? "PUBLIC" : "PRIVATE",
                image = $("#files").val();

            if (title.length < 5) {
                $("#titleAlert").fadeIn('slow', function () {
                    $("#titleAlert").delay(3500).fadeOut();
                });
                return;
            }
            else {
                console.log('sosis ' + image);
                var formData = new FormData();
                formData.append('description', caption);
                formData.append('name', title);
                formData.append('visibility', privacy);
                formData.append('image', file);
                console.log(formData)

                var myUrl = "https://cors-anywhere.herokuapp.com/photo-sharing-back-end.herokuapp.com/public/api/post";

                axios.post(myUrl, formData, {
                    headers: {
                        'Authorization': 'Bearer ' + accessToken,
                        'Content-Type': 'multipart/form-data'
                    }
                }).then(function (response) {
                    console.log("Success!")
                    console.log(response);
                }).catch(function (error) {
                    console.log("Error!");
                    console.log(error);
                });

                console.log(`Title: ${title}\nCaption: ${caption}\nPrivacy Settings: ${privacy}\nImage: ${image}`);
            }
        });
    });

    function showImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $("#previewImage").attr('src', e.target.result);
            }

            reader.readAsDataURL(input.files[0]);
        }
    }

    function getUserDetails(access_token) {
        var myUrl = "https://cors-anywhere.herokuapp.com/photo-sharing-back-end.herokuapp.com/public/api/user/details";

        axios.get(myUrl, {
            headers: {
                'Authorization': 'Bearer ' + access_token,
            }
        }).then(function (response) {
            console.log(response.data);

            $("#loggedInNavigation .profile-name").text(response.data.first_name + " " + response.data.last_name);

            if (response.data.img == null) {
                $("#loggedInNavigation .img-profile").attr('src', 'assets/img/blank_profile.png');
            } else {
                $("#loggedInNavigation .img-profile").attr('src', response.data.image);
            }

            toggleLoggedInNavigation();
        }).catch(function (error) {
            console.log(error);
        });
    }

    function toggleLoggedInNavigation() {
        $("#loggedInLandingPage").show();
        $("#loggedInNavigation").show();

        $("#notLoggedLandingPage").hide();
        $("#notLoggedInNavigation").hide();
    }

    function toggleGuestNavigation() {
        $("#loggedInLandingPage").hide();
        $("#loggedInNavigation").hide();

        $("#notLoggedInNavigation").show();
        $("#notLoggedLandingPage").show();
    }

    function logout() {
        if (localStorage.getItem("access_token") != undefined) {
            localStorage.removeItem("access_token");
        }

        setTimeout(function () {
            window.location.href = "index.html";
        }, 1000);
    }
</script>
</body>

</html>